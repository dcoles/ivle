<!-- Base Stylesheet used to render all apps -->
<html xmlns="http://www.w3.org/1999/xhtml"       
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      py:strip="">
  <py:match path="head" once="true">
    <head py:attrs="select('@*')">
      <!-- Set the appropriate title for the app -->
      <title py:with="title = list(select('title/text()'))">
        IVLE<py:if test="title"> - ${title}</py:if>
      </title>
      <!-- Set Content Type -->
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <!-- Set global Javascript variables -->
      <script type="text/javascript">
        root_dir = "${root_dir}";
        public_host = "${public_host}";
        username = "${login}";
      </script>
      <link py:if="favicon" rel="shortcut icon" href="${favicon}" />
      <!-- Global style sheet -->
      <link rel="stylesheet" type="text/css" href="/media/common/ivle.css" />
      <!-- Global Javascript-->
      <script type="text/javascript" src="/media/common/util.js"></script>
      <script type="text/javascript" src="/media/common/json2.js"></script>
      <script type="text/javascript" src="/media/common/md5.js"></script>
      <script type="text/javascript" src="/media/common/tos.js"></script>
      <!-- App-specific style sheets -->
      <py:for each="style in app_styles">
        <link rel="stylesheet" type="text/css" href="${style}" />
      </py:for>
      <!-- App-specific Javascript -->
      <py:for each="script in scripts">
        <script type="text/javascript" src="${script}"></script>
      </py:for>
      <script type="text/javascript">
        <py:for each="init_script in scripts_init">
          window.addEventListener("load", ${init_script}, false);
        </py:for>
      </script>
      ${select('*[local-name()!="title"]')}
    </head>
  </py:match>    
  <py:match path="body" once="true">
    <body>
      <div id="ivleheader"></div>
      <div id="ivleheader_text">
        <h1>IVLE</h1>
        <h2>Informatics Virtual Learning Environment</h2>
        <py:choose>
          <p py:when="publicmode" class="userhello">Running in public mode.</p>
          <p py:when="logged_in" class="userhello">
            <span id="usernick">${nick}</span>
            (<span class="username">${login}</span>) |
            <a href="/settings">Settings</a> |
            <a href="/help">Help</a> |
            <a href="/logout">Sign out</a>
          </p>
          <p py:otherwise="">Not logged in.</p>
        </py:choose>
      </div>
      <div id="ivleheader_tabs">
        <ul id="apptabs">
          <py:for each="app in apps_in_tabs">
            <li py:if="app['this_app']" class="thisapp"><py:if test="app['has_icon']"><img src="${app['icon_url']}" alt="" /> </py:if><a href="${app['path']}" title="${app['desc']}">${app['name']}</a></li>
            <li py:if="not app['this_app']"><py:if test="app['has_icon']"><img src="${app['icon_url']}" alt="" /> </py:if><a href="${app['path']}" title="${app['desc']}">${app['name']}</a></li>
          </py:for>
        </ul>
      </div>
      <div id="ivlebody">
      ${select('*')}
      </div>
    </body>
  </py:match>
  ${app_template}
</html>
